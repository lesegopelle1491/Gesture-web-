<!DOCTYPE html>
<html>
<head>
    <title>Gesture Recognition</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <style>
        video, canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
        video {
            transform: scaleX(-1); /* Mirror the video for natural hand orientation */
        }
        #gestureText {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            color: #FF0000;
        }
    </style>
</head>
<body>
    <video id="videoInput" autoplay></video>
    <canvas id="outputCanvas"></canvas>
    <div id="gestureText">Loading...</div>

    <script>
        const video = document.getElementById('videoInput');
        const canvas = document.getElementById('outputCanvas');
        const ctx = canvas.getContext('2d');
        const gestureText = document.getElementById('gestureText');

        video.addEventListener('loadeddata', () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
        });

        const gestures = [
            { id: 0, label: "Unknown" },
            { id: 1, label: "Closed_Fist" },
            { id: 2, label: "Open_Palm" },
            { id: 3, label: "Pointing_Up" },
            { id: 4, label: "Thumb_Down" },
            { id: 5, label: "Thumb_Up" },
            { id: 6, label: "Victory" },
            { id: 7, label: "ILoveYou" },
        ];

        function classifyGesture(landmarks) {
            // Example gesture detection logic based on landmark positions
            const thumbTip = landmarks[4];
            const indexTip = landmarks[8];
            const middleTip = landmarks[12];
            const ringTip = landmarks[16];
            const pinkyTip = landmarks[20];
            const wrist = landmarks[0];

            // Check distances for gestures
            const isClosedFist = [thumbTip, indexTip, middleTip, ringTip, pinkyTip].every(finger => {
                const dx = finger.x - wrist.x;
                const dy = finger.y - wrist.y;
                return Math.sqrt(dx * dx + dy * dy) < 0.15; // Adjust threshold as needed
            });

            const isOpenPalm = [thumbTip, indexTip, middleTip, ringTip, pinkyTip].some(finger => {
                const dx = finger.x - wrist.x;
                const dy = finger.y - wrist.y;
                return Math.sqrt(dx * dx + dy * dy) > 0.4; // Adjust threshold as needed
            });

            if (isClosedFist) return gestures[1];
            if (isOpenPalm) return gestures[2];

            // Add other gesture conditions here, e.g., "Thumbs Up," "Victory," etc.
            return gestures[0]; // Default to "Unknown"
        }

        const hands = new Hands({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
        });

        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 1,
            minDetectionConfidence: 0.7,
            minTrackingConfidence: 0.7
        });

        hands.onResults(results => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.save();
            ctx.translate(canvas.width, 0);
            ctx.scale(-1, 1); // Flip the canvas for mirrored video

            if (results.multiHandLandmarks) {
                for (const landmarks of results.multiHandLandmarks) {
                    drawConnectors(ctx, landmarks, HAND_CONNECTIONS, {color: '#00FF00', lineWidth: 4});
                    drawLandmarks(ctx, landmarks, {color: '#FF0000', lineWidth: 2});

                    // Classify and display the gesture
                    const gesture = classifyGesture(landmarks);
                    gestureText.textContent = `${gesture.id} - ${gesture.label}`;
                }
            } else {
                gestureText.textContent = "No Hand Detected";
            }

            ctx.restore();
        });

        const camera = new Camera(video, {
            onFrame: async () => {
                await hands.send({image: video});
            },
            width: 1280,
            height: 720
        });
        camera.start();
    </script>
</body>
</html>
